# API文档

## 注册

### 

### 验证码发送

请求地址

| 操作 | 发送4位数手机验证码至用户 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/register](http://192.168.199.122:6543/register) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | token | 用户标识 | Y | string |  | 验证用户合法性 |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":“成功";                 "0001":“该手机号已被注册";                            "0002":"其他错误"; |
| 2 | message | 相关信息 | string | 若发送成功，返回该验证码；否则返回None |

返回实例

| 示例 | {"result":"0000","message":code}；{"result":"0002","mes":None} |
| :---: | :--- |


### 

### 验证码校验

请求地址

| 操作 | 校验用户输入的验证码是否正确 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/register](http://192.168.199.122:6543/register) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | code\_v | 正确码 | Y | string | 4位数 | 发送验证码接口返回的验证码 |
| 2 | code | 输入码 | Y | string | 4位数 | 输入验证码 |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":"成功";               "0004":"验证码错误";   "0005":"验证码错误次数过多"; |
| 2 | message | 相关信息 | string | None |

返回实例

| 示例 | {"result":"0000"}   ；    {"result":"0004"} |
| :---: | :--- |


### 

### 注册step1

请求地址

| 操作 | 接受头像图片及图片名保存到本地，并将完整路径返回 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/upload](http://192.168.199.122:6543/register) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | img | 头像（包含file属性和filename属性） | N | FieldStorge |  | 今后可能需要作图像完整性验证 |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":"成功";               "0006":"未知错误"; |
| 2 | message | 相关信息 | string | 成功则返回完整路径 |

返回实例

| 示例 | {"result":"0000","message":file\_path};{"result":"0004","message":None} |
| :---: | :--- |


### 

### 注册step2

请求地址

| 操作 | 接受用户信息 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/register](http://192.168.199.122:6543/register) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | userId | 用户名 | Y | string | 11位电话号码 |  |
| 2 | headImage | 头像完整路径名 | N | sring |  |  |
| 3 | password | 密码 | Y | string | 至少8位 | 同时包括字母和数字 |
| 4 | gender | 性别 | N | string |  | “0”：女  ； “1”：男 |
| 5 | nickname | 昵称 | N | string |  |  |
| 6 | register |  | Y | string |  | 修饰视图，值为"1" |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":"成功";               "0006":"未知错误"; |
| 2 | message | 相关信息 | string | None |

返回实例

| 示例 | {"result":"0000"};{"result":"0006"} |
| :---: | :--- |


## 

## 登录

请求地址

| 操作 | 登录 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/log](http://192.168.199.122:6543/log) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | userId | 手机号（账户名） | Y | string | 11位 | 11位手机号码，由前端完成格式验证 |
| 2 | password | 密码 | Y | string | 至少8位 | 包含数字和字母 |
| 3 | expire\_in | token有效期 | Y | string | 以秒为单位 | 7天？ |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":“成功";                 "0007":“用户不存在";   "0008":"密码错误"; |
| 2 | message | 相关信息 | string | 成功返回token，否则返回None |

返回实例

| 示例 | {"result":"0000,"message":token}；{"result":"0007","message":None}； {"result":"0008","message":None} |
| :---: | :--- |


## 

## 房间

### 直播请求

请求地址

| 操作 | 向七牛请求直播房间 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/room](http://192.168.199.122:6543/room) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | token | 用户标示 | Y | string |  | 验证用户合法性 |
| 2 | title | 直播间标题 |  | string |  |  |
| 3 | live |  | Y | string |  | 值为“1”，修饰视图 |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":“成功";                 "0009":“API错误，bad request"; |
| 2 | message | 相关信息 | string | 若成功，返回stream\(json\)；否则返回None |

返回实例

| 示例 | {u'message': u'{"nonce": 0, "publishSecurity": "static", "hub": "mrpyq", "expireAt": "2017-01-22T10:28:45.799148343+08:00", "title": "586f00dd5e77b017852a1a7e", "publishKey": "96aaffaee4505e6d", "disabled": false, "disabledTill": 0, "nropEnable": null, "hosts": {"live": {"snapshot": "pili-live-snapshot.mrpyq.com", "http": "pili-live-hls.mrpyq.com", "hdl": "pili-live-hdl.mrpyq.com", "hls": "pili-live-hls.mrpyq.com", "rtmp": "pili-live-rtmp.mrpyq.com"}, "playback": {"http": "10004p0.playback1.z1.pili.qiniucdn.com", "hls": "10004p0.playback1.z1.pili.qiniucdn.com"}, "play": {"http": "pili-live-hls.mrpyq.com", "rtmp": "pili-live-rtmp.mrpyq.com"}, "publish": {"rtmp": "pili-publish.mrpyq.com"}}, "updatedAt": "2017-01-06T10:28:45.799+08:00", "id": "z1.mrpyq.586f00dd5e77b017852a1a7e", "createdAt": "2017-01-06T10:28:45.799+08:00"}', u'result': u'0000'} |
| :---: | :--- |


### 主播离开

请求地址

| 操作 | 主播离开直播房间，直播关闭 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/room](http://192.168.199.122:6543/room) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | token | 用户标示 | Y | string |  | 验证用户合法性 |
| 2 | leave |  | Y | string |  | 值为"1",修饰视图 |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":“成功";                 "0009":“API错误，bad request"; |
| 2 | message | 相关信息 | string | None |

返回实例

| 示例 | {"result":"0009"} |
| :---: | :--- |


## 

## 列表

### 好友列表

请求地址

| 操作 | 返回好友列表，正在直播的排序在前 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/list](http://192.168.199.122:6543/list) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | token | 用户标示 | Y | string |  | 验证用户合法性 |
| 2 | friendlist |  | Y | string |  | 值为"1"，修饰视图 |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":“成功"; |
| 2 | message | 相关信息 | string | 好友列表 |

返回实例

| 示例 | {"result":"0000"  ,  "message" : {"count": 0, "friends": \[\]}} |
| :---: | :--- |


### 

### 消息列表

请求地址

| 操作 | 返回消息列表 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/list](http://192.168.199.122:6543/list) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | token | 用户标示 | Y | string |  | 验证用户合法性 |
| 2 | messagelist |  | Y | string |  | 值为"1"，修饰视图 |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":“成功"; |
| 2 | message | 相关信息 | string | 消息列表 |

返回实例

| 示例 | {"result":"0000"  ,  "message" : messages} |
| :---: | :--- |


备注

| 备注 | messages是list对象，每个元素表示一条消息（字典），消息中设有状态标志flag，不同的值代表不同的含义:被申请者0:待接受，1:已接受;   申请者2:等待验证，3:已同意 |
| :--- | :--- |


## 用户管理

### 用户搜索

请求地址

| 操作 | 根据手机号准确搜索用户 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/friend](http://192.168.199.122:6543/friend) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | token | 用户标示 | Y | string |  | 验证用户合法性 |
| 2 | userId | 搜索目标帐号 | Y | string | 11位 | 电话号码 |
| 3 | search |  | Y | string |  | 值为"1",修饰视图 |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":“成功";                 "0007":"用户不存在" |
| 2 | message | 相关信息 | string | 成功则返回用户信息，否则返回None |
| 3 | flag | 是否为好友 | string | "1":好友 ； "0":陌生人；“-1”：目标为自己； |

返回实例

| 示例 |  |
| :---: | :--- |


### 

### 添加好友

请求地址

| 操作 | 根据手机号准确搜索用户 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/friend](http://192.168.199.122:6543/friend) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | token | 用户标示 | Y | string |  | 验证用户合法性 |
| 2 | userId | 搜索目标帐号 | Y | string | 11位 | 电话号码 |
| 3 | add |  | Y | string |  | 值为"1",修饰视图 |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":“成功";                 "0010":"已经互为好友" |
| 2 | message | 相关信息 | string | None |

返回实例

| 示例 | {"result":"0010","mes":None} |
| :---: | :--- |


### 

### 消息处理

请求地址

| 操作 | 根据手机号准确搜索用户 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/friend](http://192.168.199.122:6543/friend) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | token | 用户标示 | Y | string |  | 验证用户合法性 |
| 2 | userId | 申请者的用户Id | Y | string |  | 电话号码 |
| 2 | verifyId | 识别被申请方待同意消息 | Y | string |  | “电话号码,时间戳“ |
| 3 | objectId | 识别申请方对应的待接受消息 | Y | string |  | “电话号码，时间戳” |
| 3 | behaviour | 对消息的处理方式 | Y | string |  | "accept"：同意申请； "delete"：删除消息； |
| 4 | dealMessage |  | Y | string |  | 值为"1",修饰视图 |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":“成功"; |

返回实例

| 示例 | {"result":"0010"} |
| :---: | :--- |


### 

### 删除好友

请求地址

| 操作 | 根据手机号准确搜索用户 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/friend](http://192.168.199.122:6543/friend) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | token | 用户标示 | Y | string |  | 验证用户合法性 |
| 2 | userId | 目标帐号 | Y | string | 11位 | 电话号码 |
| 4 | delete |  | Y | string |  | 值为"1",修饰视图 |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":“成功"；“0006”：“未知错误” |

返回实例

| 示例 | {"result":"0010"} |
| :---: | :--- |


## 金币系统
### 充值
请求地址

| 操作 | 充值 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/friend](http://192.168.199.122:6543/golden) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | token | 用户标示 | Y | string |  | 验证用户合法性 |
| 2 | money | 充值金额 | Y | string |  | 10元;50元;100元; |
| 3 | refill |  | Y | string |  | 值为"1",修饰视图 |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":“成功"；“0013”：“数据库更新错误” |

返回实例

| 示例 | {"result":"0000","message":None} |
| :---: | :--- |

### 赠送礼物
请求地址

| 操作 | 向喜爱的主播赠送礼物 |
| :---: | :---: |
| 协议 | http |
| 方式 | POST |
| URL全径 | [http://192.168.199.122/friend](http://192.168.199.122:6543/golden) |

请求参数

| 序号 | 参数名 | 中文名称 | 必选 | 数据类型 | 长度 | 备注 |
| :--- | :---: | :--- | :--- | :--- | :--- | :--- |
| 1 | token | 用户标示 | Y | string |  | 验证用户合法性 |
| 2 | value | 礼物价值 | Y | string |  |  |
| 3 | object | 主播id | Y | string |  |  |
| 4 | description | 礼物描述 | Y | string |  |  |
| 5 | send_gift |  | Y | string |  | 值为"1",修饰视图 |

返回数据

| 序号 | 参数名 | 中文名称 | 数据类型 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| 1 | result | 返回结果 | string | “0000":“成功"；“0013”：“数据库更新错误” |

返回实例

| 示例 | {"result":"0013","message":"update failed"} |
| :---: | :--- |
